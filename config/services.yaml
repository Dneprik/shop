# config/services.yaml
# This file is the entry point to configure your own services.
# Files in the packages/ subdirectory configure your dependencies.

parameters: { }

services:
    # --- автоконфигурация по умолчанию ---
    _defaults:
        autowire: true       # автоматически внедряет зависимости по типам
        autoconfigure: true  # автоматически регистрирует команды, сабскрайберы и т.д.
        public: false

    # --- автозагрузка всех классов из src/ как сервисов ---
    App\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Entity/'        # сущности не регистрируем как сервисы
            - '../src/Kernel.php'

    # --- явно регистрируем наших SMS-провайдеров ---
    App\Service\SmsProviderA:
        arguments:
            $logger: '@logger'

    App\Service\SmsProviderB:
        arguments:
            $logger: '@logger'

    # --- роутер SMS с фолбэком и лимитом 5/мин на провайдера ---
    #   SmsRouter ожидает:
    #     - iterable $providers (в порядке приоритета)
    #     - RateLimiterFactory $smsLimiter (ссылаемся на limiter.sms_global)
    App\Service\SmsRouter:
        arguments:
            $providers:
                - '@App\Service\SmsProviderA'
                - '@App\Service\SmsProviderB'
            $smsLimiter: '@limiter.sms_global'
